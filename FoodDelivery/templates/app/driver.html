{% extends 'app/base.html' %}
{% load auth_extras %}

{% block content %}

{% if user.is_authenticated %}
    {% if user|has_group:'Driver' %}
        <div class="ml-5"
            <form action='' method='GET'>
                <div class="row">
                    <label for="filter_facility">Provozovna:</label>
                    
                    <select name='filter_facility'>
                        <option {% if filter_facility == 'all' %} selected='selected' {% endif %} value='all'> --- </option>
                        {% for fac in facilities %}
                            <option {% if filter_facility == fac.id %} selected='selected' {% endif %} value={{ fac.id }}>{{ fac.name }}</option>
                        {% endfor %}
                    </select>
                </div>  

                {# filter by facility #}
                <br>Provozovna:
                <select name='filter_facility'>
                    <option {% if filter_facility == 'all' %} selected='selected' {% endif %} value='all'> --- </option>
                    {% for fac in facilities %}
                        <option {% if filter_facility == fac.id %} selected='selected' {% endif %} value={{ fac.id }}>{{ fac.name }}</option>
                    {% endfor %}
                </select>

                {# fitler by state #}
                <br>Stav objednávky:
                <select name='filter_state'>
                    <option value='all' {% if filter_state == 'all' %} selected='selected' {% endif %}> --- </option>
                    <option value='C' {% if filter_state == 'C' %} selected='selected' {% endif %}> vytvořena </option>
                    <option value='X' {% if filter_state == 'X' %} selected='selected' {% endif %}> zrušena </option>
                    <option value='A' {% if filter_state == 'A' %} selected='selected' {% endif %}> akceptována </option>
                    <option value='D' {% if filter_state == 'D' %} selected='selected' {% endif %}> na cestě </option>
                    <option value='F' {% if filter_state == 'F' %} selected='selected' {% endif %}> vyřízena </option>
                </select>

                {# filter by date #}
                <br>Datum:
                <input type='date' name='filter_date' value={{ filter_date }} />

                <button type='submit'>Filtruj</button>
            </form>
        </div>

        {% if orders %}
            <ul>
                {% for order in orders %}
                    <li>
                        <h3> {{ forloop.counter }}. Objednávka<br></h3>
                        {# {{ order.items }}<br> #}
                        datum: {{ order.date }}<br>
                        cena: {{ order.price }}<br>
                        restaurce: {{ order.belongs_to }}<br>
                        příjemce: {{ order.created_by }}<br>

                        {% if order.state == 'A' %}
                            stav: akceptováno
                        {% elif order.state == 'D' %}
                            stav: na cestě
                        {% elif order.state == 'F' %}
                            stav: vyřízeno
                        {% endif %}
                        <br>

                        {% if order.state != 'F' %}
                            <form action="" method="POST"> {% csrf_token %}
                                <input type="hidden" name="order_id" value={{ order.id }} />
                                <button type="submit">Hotovo</button>
                            </form>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>Zadne objednavky.</p>
        {% endif %}
    {% else %}
        Tato stránka je pouze pro řidiče!<br>
        <a href="{% url 'index' %}" > zpět </a><br>
    {% endif %}
{% else %}
    Musíte se nejdřív přihlásit!<br>
    <a href="{% url 'login' %}" > přihlasit se </a><br>
{% endif %}

{% endblock %}
